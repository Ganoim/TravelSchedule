<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.TravelSchedule.dao.TravelDao">
  <select id="selectCalendar" resultType="calendar">
  select * from calendar where mid=#{mid}
  </select>
  <insert id="insertCalendar">
  insert into calendar(mid, cdcode, cdname) values(#{mid}, #{cdcode}, #{cdname})
  </insert>
  <select id="maxcode">
  select nvl(max(cdcode),'CD00000') from calendar where mid = #{mid}
  </select>
  <select id="selectCdcode" resultType="calendar">
  select distinct cdcode, cdname from calendar where mid = #{mid} order by cdcode
  </select>
  <insert id="insertFKcode">
  	insert into schedule(mid, cdcode, tdcode) values(#{mid},#{cdcode},#{tdcode})
  </insert>
  <insert id="insertFEcode">
  	insert into schedule(mid, cdcode, fecode) values(#{mid},#{cdcode},#{fecode})
  </insert>
  <select id="selectSchedule" resultType="sc">
  select * from schedule where mid = #{sc.mid} and cdcode = #{sc.cdcode} and 
  <if test="seloption == 'tdest'">
  tdcode = #{sc.tdcode}
  </if>
  <if test="seloption == 'festival'">
  fecode = #{sc.fecode}
  </if>
  </select>
  <select id="selectTdest" resultType="tdest">
  select * from tdest where tdcode = #{tdcode}
  </select>
  <update id="updateSc">
  update schedule set  scdate = to_date(#{sc.scdate}, 'YYYY-MM-DD HH24:MI')
  where mid = #{sc.mid} and cdcode = #{sc.cdcode} and
  <if test="seloption == 'tdest'">
  tdcode = #{sc.tdcode}
  </if>
  <if test="seloption == 'festival'">
  fecode = #{sc.fecode}
  </if>
  </update>
  <select id="select_sc_td_join" resultType="hashmap">
  select sc.mid, sc.cdcode, sc.fecode, sc.tdcode, to_char(sc.scdate, 'YYYY/MM/DD HH24:MI') as scdate, td.*, fe.* from schedule sc left join tdest td on sc.tdcode = td.tdcode left join festival fe on sc.fecode = fe.fecode where sc.mid= #{mid} and sc.cdcode = #{cdcode} order by sc.scdate
  </select>
  <select id="selectTdest_Nearby">
  <![CDATA[
  select * from tdest where ctcode = #{ctcode} and tdcode not in(#{tdcode}) order by  DBMS_RANDOM.RANDOM() 
  ]]>
  </select>
  </mapper>